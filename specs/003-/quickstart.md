# Quickstart: 待办事项拖拽排序

**Feature**: 003-
**Date**: 2025-10-01
**Purpose**: 功能验收和快速测试指南

## 前置条件

- 应用已启动并运行在 http://localhost:3000
- 浏览器支持现代JavaScript (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
- 已有至少3个待办事项(用于拖拽测试)

## 快速验收流程

### 场景1: 基本拖拽排序 (桌面)

**目标**: 验证鼠标拖拽功能和视觉反馈

1. **准备**:
   - 打开应用,确保有至少3个未完成的待办事项
   - 如果没有,点击"添加待办事项"创建几个

2. **执行拖拽**:
   ```
   步骤1: 鼠标悬停在第1个待办事项上
   预期: 显示拖拽手柄图标或改变鼠标样式

   步骤2: 按住鼠标左键
   预期: 待办事项抬起(略微放大),增加阴影,其他项保持不变

   步骤3: 向下拖动到第3个待办事项位置
   预期:
   - 被拖拽项跟随鼠标移动,半透明效果
   - 第2和第3项平滑向上移动让出空间
   - 显示插入位置指示线

   步骤4: 释放鼠标
   预期:
   - 待办事项固定在第3个位置
   - 所有项平滑过渡到新位置
   - 显示成功提示(可选)
   ```

3. **验证持久化**:
   ```
   步骤5: 按F5刷新页面
   预期: 待办事项顺序保持不变,拖拽结果已保存
   ```

**验收标准**: ✅ 拖拽流畅,视觉反馈明确,顺序持久化

---

### 场景2: 跨状态拖拽限制

**目标**: 验证已完成和未完成的待办事项独立排序

1. **准备**:
   - 确保有2个未完成和2个已完成的待办事项
   - 切换到"全部"过滤视图

2. **执行拖拽**:
   ```
   步骤1: 拖拽一个未完成项到已完成项的位置
   预期:
   - 未完成项只能在未完成区域内移动
   - 无法拖入已完成区域
   - 显示禁止图标或高亮边界

   步骤2: 拖拽一个已完成项到未完成项的位置
   预期: 同上,已完成项只能在已完成区域内移动
   ```

**验收标准**: ✅ 不允许跨状态拖拽

---

### 场景3: 移动设备拖拽 (可选)

**目标**: 验证触摸拖拽和手势区分

1. **准备**:
   - 使用移动设备或浏览器DevTools切换到移动视图
   - 确保有至少3个待办事项

2. **执行拖拽**:
   ```
   步骤1: 快速滑动列表
   预期: 列表正常滚动,不触发拖拽

   步骤2: 长按(500ms)第1个待办事项
   预期:
   - 震动反馈(如果设备支持)
   - 待办事项抬起,进入拖拽模式

   步骤3: 移动手指到第2个待办事项位置
   预期: 和桌面拖拽相同的视觉反馈

   步骤4: 松开手指
   预期: 待办事项固定在新位置
   ```

**验收标准**: ✅ 长按触发拖拽,滑动正常滚动,无冲突

---

### 场景4: 键盘操作 (无障碍)

**目标**: 验证键盘导航和拖拽

1. **准备**:
   - 确保有至少3个待办事项
   - 关闭鼠标,仅使用键盘

2. **执行拖拽**:
   ```
   步骤1: 按Tab键聚焦到第1个待办事项
   预期: 显示明显的焦点边框

   步骤2: 按Space键
   预期:
   - 播报"拖拽模式激活,当前位置第1,共3项"
   - 显示键盘操作提示

   步骤3: 按向下箭头键2次
   预期:
   - 播报"移动到第2位"、"移动到第3位"
   - 视觉指示当前目标位置

   步骤4: 按Enter键确认
   预期:
   - 待办事项移动到第3位
   - 播报"已移动到第3位"
   - 退出拖拽模式

   步骤5: (可选) 在拖拽模式下按Esc键
   预期:
   - 取消拖拽,恢复原位置
   - 播报"拖拽已取消"
   ```

**验收标准**: ✅ 完整的键盘操作支持,语音播报准确

---

### 场景5: 过滤视图拖拽

**目标**: 验证不同过滤状态下的拖拽行为

1. **准备**:
   - 创建4个未完成和3个已完成的待办事项

2. **待完成视图**:
   ```
   步骤1: 点击"待完成"过滤按钮
   预期: 仅显示4个未完成的待办事项

   步骤2: 拖拽第1项到第4项位置
   预期: 正常拖拽,顺序更新

   步骤3: 切换到"全部"视图
   预期: 未完成项的顺序保持,已完成项不受影响
   ```

3. **已完成视图**:
   ```
   步骤4: 点击"已完成"过滤按钮
   预期: 仅显示3个已完成的待办事项

   步骤5: 拖拽第2项到第1项位置
   预期: 正常拖拽,顺序更新

   步骤6: 切换回"全部"视图
   预期: 已完成项的顺序更新,未完成项保持不变
   ```

**验收标准**: ✅ 各过滤视图独立拖拽,状态隔离

---

### 场景6: 边界情况

**目标**: 验证异常场景的处理

1. **单项列表**:
   ```
   步骤1: 删除所有待办事项,仅保留1个
   预期: 拖拽功能禁用或显示提示"至少需要2项才能排序"
   ```

2. **拖出边界**:
   ```
   步骤2: 创建多个待办事项,拖拽一个项到列表区域外
   预期:
   - 拖拽取消,待办事项恢复原位置
   - 显示提示"拖拽已取消"
   ```

3. **拖拽时切换过滤**:
   ```
   步骤3: 开始拖拽一个待办事项(不要松手)
   步骤4: 同时点击其他过滤按钮(如果可能,或让协助者点击)
   预期: 拖拽自动取消,切换到新过滤视图
   ```

**验收标准**: ✅ 所有边界情况有明确的处理和反馈

---

## 性能验证

### 流畅度测试

1. **创建50个待办事项** (使用开发者工具批量创建)
2. **拖拽第1项到第50项位置**
   - 预期响应时间: < 100ms
   - 预期帧率: 60fps (使用Chrome DevTools Performance tab测量)
3. **快速连续拖拽5次**
   - 预期: 无卡顿,动画流畅

**验收标准**: ✅ 大量数据下仍保持流畅

---

## 回归测试

验证拖拽功能不影响现有功能:

- [ ] 添加待办事项正常工作
- [ ] 完成/取消完成待办事项正常工作
- [ ] 删除待办事项正常工作
- [ ] 过滤器(全部/待完成/已完成)正常工作
- [ ] 统计信息(总计/已完成/待完成)正确显示
- [ ] 进度条正确显示完成百分比
- [ ] 庆祝动画在完成最后一项时触发
- [ ] 空状态提示正确显示

**验收标准**: ✅ 所有现有功能无退化

---

## 浏览器兼容性检查

在以下浏览器中重复场景1-3:

- [ ] Chrome 90+ (Windows/Mac)
- [ ] Firefox 88+ (Windows/Mac)
- [ ] Safari 14+ (Mac/iOS)
- [ ] Edge 90+ (Windows)
- [ ] 移动Chrome (Android)
- [ ] 移动Safari (iOS)

**验收标准**: ✅ 所有目标浏览器功能一致

---

## 无障碍检查清单

使用屏幕阅读器验证:

- [ ] 所有拖拽操作有语音反馈
- [ ] 键盘操作完整可用
- [ ] 焦点指示器清晰可见
- [ ] ARIA属性正确设置(aria-grabbed, aria-dropeffect)
- [ ] 高对比度模式下可用

工具:
- NVDA (Windows) 或 VoiceOver (Mac/iOS)
- axe DevTools
- WAVE浏览器扩展

**验收标准**: ✅ 通过WCAG 2.1 AA标准

---

## 故障排除

### 常见问题

**问题1**: 拖拽不响应
- 检查: 浏览器控制台是否有JavaScript错误
- 检查: @dnd-kit库是否正确加载 (network tab)
- 解决: 清除缓存,重新安装依赖

**问题2**: 顺序不持久化
- 检查: LocalStorage是否被禁用
- 检查: 浏览器控制台Application > LocalStorage > todos
- 解决: 启用LocalStorage,检查存储代码

**问题3**: 拖拽卡顿
- 检查: Chrome DevTools Performance tab,查找长任务
- 检查: 是否使用了CSS transform (而非top/left)
- 解决: 优化动画,使用GPU加速

**问题4**: 移动端滚动冲突
- 检查: 长按延迟是否设置(500ms)
- 检查: touch事件是否正确处理
- 解决: 调整延迟时间,测试不同设备

---

## 验收签字

功能完成并通过所有场景测试后:

- [ ] 开发者自测完成
- [ ] 同行评审通过
- [ ] 产品经理验收通过
- [ ] 无障碍测试通过
- [ ] 浏览器兼容性测试通过

**签字**: __________ **日期**: __________

---

## 下一步

功能验收通过后:
1. 合并到主分支
2. 部署到生产环境
3. 监控用户反馈
4. 迭代优化
